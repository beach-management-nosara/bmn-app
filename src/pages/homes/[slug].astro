---
import { Image } from "astro:assets";

import MainLayout from "@/layouts/main-layout.astro";
import Tabs from "@/components/jsx/property-tabs";
import { MapPin, Star } from "lucide-react";

export const prerender = false;

const { slug } = Astro.params;

const apiKey = import.meta.env.API_KEY;

const response = await fetch(`https://api.lodgify.com/v2/properties/${slug}/rooms`, {
    method: "GET",
    headers: {
        "X-ApiKey": apiKey,
        "Content-Type": "application/json"
    }
});
const resjson = await response.json();
const data = resjson[0];

const response2 = await fetch(`https://api.lodgify.com/v2/properties/${slug}`, {
    method: "GET",
    headers: {
        "X-ApiKey": apiKey,
        "Content-Type": "application/json"
    }
});
const resjson2 = await response2.json();
const data2 = resjson2;
---

<MainLayout>
    <div class="mx-auto flex max-w-screen-2xl flex-col items-center bg-gray-100">
        <div class="relative h-[450px] w-full">
            <Image
                src={data.image_url}
                alt="hero"
                width={662}
                height={225}
                format="webp"
                class="h-[450px] w-full object-cover"
            />

            <div
                class="absolute inset-0 flex flex-col items-center justify-center bg-black bg-opacity-50 px-2 text-center text-white"
            >
                <h2
                    class="text-2xl uppercase tracking-[.45em] text-[#ffffff3a] text-gray-400 opacity-40 md:text-4xl"
                >
                    HOUSE
                </h2>
                <h1
                    class="text-2xl font-medium uppercase leading-tight tracking-[.35em] text-white md:text-[3.6em]"
                >
                    {data.name}
                </h1>
            </div>
        </div>

        <div class="container mx-4 mx-auto">
            <div class="grid grid-cols-1 bg-white md:grid-cols-3">
                <!-- Left Column (2fr) -->
                <div class="p-4 md:col-span-2">
                    <h1 class="text-3xl font-bold">{data.name}</h1>
                    <span class="flex items-center gap-2"
                        ><MapPin size={16} /><span class="my-2 text-sm">
                            {data2.city}, {data2.state}, {data2.country}
                        </span></span
                    >
                    <div class="h-1 w-full border-t border-gray-300"></div>
                    <div class="my-4">
                        <span class="text-sm">Guests: {data.max_people}</span> •
                        <span class="text-sm">Bedrooms: {data.bedrooms}</span> •
                        <span class="text-sm">Bathrooms: {data.bathrooms}</span>
                        <span class="float-right flex items-center gap-2 text-sm font-bold"
                            ><span>Rating: </span><Star size={16} className="text-primary" /><span
                                >{data2.rating}</span
                            ></span
                        >
                    </div>
                    <div class="h-1 w-full border-t border-gray-300"></div>
                    <Tabs data={data} client:load />
                </div>

                <!-- Right Column (1fr) -->
                <div class="sticky top-20 m-4 h-96 rounded bg-white p-4 shadow-lg">
                    <div class="border-b pb-4">
                        <span class="text-xl font-bold text-primary"
                            ><span class="text-sm text-muted">FROM</span>
                            <span class="text-sm">{data2.currency_code}</span>
                            {Math.round(data.min_price)} / {
                                data.price_unit_in_days === 0 ? "" : data.price_unit_in_days
                            }
                            <span class="text-sm"
                                >{
                                    data.price_unit_in_days === 7
                                        ? "week"
                                        : data.price_unit_in_days === 0
                                          ? "day"
                                          : "days"
                                }</span
                            ></span
                        >
                    </div>
                    <div class="my-4">
                        <label for="check-in" class="mb-2 block text-sm font-medium text-gray-900"
                            >Check In</label
                        >
                        <input
                            type="text"
                            id="check-in"
                            class="block w-full rounded-lg border border-gray-300 bg-gray-50 p-2.5 text-sm text-gray-900 focus:border-blue-500 focus:ring-blue-500"
                            placeholder="Add start date"
                        />
                    </div>
                    <div class="my-4">
                        <label for="check-out" class="mb-2 block text-sm font-medium text-gray-900"
                            >Check Out</label
                        >
                        <input
                            type="text"
                            id="check-out"
                            class="block w-full rounded-lg border border-gray-300 bg-gray-50 p-2.5 text-sm text-gray-900 focus:border-blue-500 focus:ring-blue-500"
                            placeholder="Add end date"
                        />
                    </div>
                    <button class="mt-4 w-full rounded-lg bg-primary px-4 py-2 text-white"
                        >Search</button
                    >
                    <p class="my-4 text-sm">
                        Get in touch with Beach Management Nosara to plan your trip or ask any
                        questions.
                    </p>
                </div>
            </div>
        </div>
    </div>
</MainLayout>
